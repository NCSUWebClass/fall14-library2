<!DOCTYPE html>
<html>
<head>
<title>Occupied: 50%</title>
<style type="text/css">
  @font-face {
    font-family: 'EH';
    src: url("ehsmb.eot");
    src: url("ehsmb.eot") format("embedded-opentype"),
    url("ehsmb.woff2") format("woff2"),
    url("ehsmb.woff") format("woff"),
    url("ehsmb.ttf") format("truetype"),
    url("ehsmb.svg#ElectronicHighwaySignRegular") format("svg");
  }
div.background{
  background-image: url("./img/football-field-endzone.png");
  background-size: 100% 100%;
  position:absolute;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  z-index: 2;
}
div.container{
  position:absolute;
  bottom: 26%;
  height: 48%;
  width: 100%;
  z-index: 1;
}
div#red_sea{
  position: absolute;
  bottom: 0;
  width: 100%;
  background-color: #FF0000;
  height: 50%;
}

img{
  z-index: 3;
  width: 3%;
  position: absolute;
  left: 0;
  user-select: none;
  -webkit-user-select: none;
}

body{
  margin: 0;
  padding: 0;
}
</style>
<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
<script>

$(document).ready(function(){
	
  var $sea = $("#red_sea");
  var height = 50;
  var title = $("title")[0];
  var temp = 0;
  var entering = 0;
  var foo=new Sound("./sounds/grunt.mp3",100,false);
  var crowd=new Sound("./sounds/crowd.mp3",100,false);
  var cheer=new Sound("./sounds/cheer.mp3",100,false);
  var starting = 0;
 
  var animateIn = function(){
    if(height + entering >= 100){
      return;
    }
    if (height + entering == 99 && starting == 0) {
      crowd.start();
      starting = 1;
    }
    entering++;
    starting = 0;
    var $img = $("<img src='./img/football-player.png' style='z-index: 3;' />");
    $("#background").prepend($img);
    $img.css("top", (Math.random() * (window.innerHeight - $img.height())) + "px");
    $img.animate({left: (window.innerWidth / 2) + "px",
                   top: (window.innerHeight / 2) + "px"},
      1500,
      "linear", 
      function(){
        $(this).remove();
        height += 1;
        title.text = "Occupied: " + height + "%";
        $sea.css("height", (height) + "%");
        // added this transition again for a more liquid "feel", but feel free to remove it
        $sea.css('transition', 'height 1s ease');
        foo.start();
        entering--;
      });
  }


  var animateOut = function(){
    if(height <= 0){
      return;
    }
    if (height + entering == 100) {
      crowd.stop();
    }
    // WARNING: If you uncomment this, do not hold down or spam a key press.  Things can get loud quickly.
    cheer.start();
    height -= 1;
    title.text = "Occupied: " + height + "%";
    $sea.css("height", (height) + "%");
    // added this transition again for a more liquid "feel", but feel free to remove it
    $sea.css('transition', 'height 1s ease');

    var $img = $("<img src='./img/football-player.png' style='z-index: 3;' />");
    $("#background").prepend($img);

    $img.css({left: (window.innerWidth / 2) + "px",
                   top: (window.innerHeight / 2) + "px"});
    
    $img.animate({left: (window.innerWidth - $img.width()) + "px",
                   top: (Math.random() * (window.innerHeight - $img.height())) + "px"},
      1500,
      "linear", 
      function(){
        $(this).remove();
      });
  }
  
  setInterval(function(){
	    $.ajax({
	    	  type: "GET",
	      	  url: "./src/WebClassServlet",
	      	  data: { CurrentCapacity: height},
	      	  success: function(result){
	      		  automatePeople(result);
	      	  }
	      }); 
  }, 5000)
  
  
  var automatePeople = function(people){
	  var newPeople = parseInt(people);
	  if(newPeople > 0){
		  for(var i =0; i < newPeople; i++){
			  animateIn();
		  }
	  }
	  else{
		  newPeople *= -1;
		  for(var i =0; i < newPeople; i++){
			  animateOut();
		  }
	  }
  }
  
  
  $("body").on("click", function(){
    animateIn();    
  });

  $("body").on("keypress", function(){
    animateOut();
  });
  function Sound(source,volume,loop)
  {
    this.source=source;
    this.volume=volume;
    this.loop=loop;
    var son;
    this.son=son;
    this.finish=false;
    this.stop=function()
    {
      document.body.removeChild(this.son);
    }
    this.start=function()
    {
      if(this.finish)return false;
      this.son=document.createElement("embed");
      this.son.setAttribute("src",this.source);
      this.son.setAttribute("hidden","true");
      this.son.setAttribute("volume",this.volume);
      this.son.setAttribute("autostart","true");
      this.son.setAttribute("loop",this.loop);
      document.body.appendChild(this.son);
    }
    this.remove=function()
    {
      document.body.removeChild(this.son);
      this.finish=true;
    }
    this.init=function(volume,loop)
    {
      this.finish=false;
      this.volume=volume;
      this.loop=loop;
    }
  }
});



</script>
</head>
<body>
<div class="background" id="background"></div>
<div class="container">
  <div id="red_sea"></div>
</div>
</body>
</html>